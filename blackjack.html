<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Iantopia Blackjack</title>
<link rel="preload" as="image" href="/strubles.png">
<style>
  :root { --bg:#0f1115; --panel:#161c27; --ink:#e9eef9; --muted:#9fb0cf; --accent:#22d3ee; --danger:#ff6b6b; }
  * { box-sizing:border-box; }
  body {
    margin:0; background:var(--bg); color:var(--ink);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px;
  }
  .table { width:min(900px, 95vw); background:var(--panel); border:1px solid #233049;
    border-radius:18px; padding:20px; box-shadow:0 20px 50px rgba(0,0,0,.45); }
  header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
  header a { color:var(--muted); text-decoration:none; border:1px solid #2a3854; padding:8px 12px; border-radius:10px; }

  h1 { margin:0; font-size:clamp(22px,3.5vw,28px); letter-spacing:.3px; }
  .row { margin-top:14px; padding:14px; border-radius:12px; background:rgba(255,255,255,0.03); border:1px solid #233049; }
  .label { color:var(--muted); font-size:.95rem; margin-bottom:6px; }
  .hand { display:flex; gap:10px; flex-wrap:wrap; align-items:center; min-height:66px; }
  .card { width:48px; height:66px; border-radius:8px; border:1px solid #2b3a58; background:#0c1018;
    display:grid; place-items:center; font-weight:700; font-size:18px; box-shadow:0 6px 18px rgba(0,0,0,.35); }
  .red { color:#ff97a0; }
  .controls { display:flex; gap:10px; margin-top:16px; flex-wrap:wrap; align-items:center; }
  button {
    all:unset; cursor:pointer; padding:12px 16px; border-radius:12px; border:1px solid #2a3854;
    background:#1c2434; color:var(--ink); box-shadow:0 8px 24px rgba(0,0,0,.35); font-weight:600;
  }
  button.primary { background:#122231; border-color:#29415c; }
  button.accent { background:rgba(34,211,238,.12); border-color:#2a4956; }
  button.danger { background:rgba(255,107,107,.12); border-color:#5a2f3b; }
  button:disabled { opacity:.5; cursor:not-allowed; }
  .status { margin-top:12px; font-weight:700; }
  .chips { margin-top:8px; color:var(--muted); font-size:.95rem; }

  /* Strubles badge */
  #strubles-badge{
    position:fixed; top:15px; left:20px; display:flex; align-items:center; gap:8px;
    background:rgba(0,0,0,.6); padding:8px 12px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,.25);
    font-weight:700;
  }
  #strubles-badge img{ width:28px; height:28px; border-radius:6px; }
  .betbox{ display:flex; align-items:center; gap:8px; }
  .betbox input{ width:90px; padding:8px 10px; border-radius:10px; border:1px solid #2a3854; background:#0f1523; color:var(--ink); font-weight:700; }
</style>
</head>
<body>
  <!-- Balance badge -->
  <div id="strubles-badge">
    <img src="/strubles.png" alt="Struble">
    <span id="bal">0</span>
  </div>

  <main class="table">
    <header>
      <a href="/" title="Back to Iantopia">‚Üê Home</a>
      <h1>Blackjack at Iantopia</h1>
      <div style="width:86px;"></div>
    </header>

    <section class="row">
      <div class="label">Dealer</div>
      <div class="hand" id="dealer-hand"></div>
    </section>

    <section class="row">
      <div class="label">You</div>
      <div class="hand" id="player-hand"></div>
      <div class="chips" id="totals">Total: ‚Äî</div>
    </section>

    <div class="controls">
      <div class="betbox">
        <span class="label" style="margin:0;">Bet</span>
        <button id="bet-minus">‚àí</button>
        <input id="bet" type="number" min="1" step="1" value="10" />
        <button id="bet-plus">+</button>
      </div>

      <button id="btn-deal"   class="primary">Deal</button>
      <button id="btn-hit"    class="accent"  disabled>Hit</button>
      <button id="btn-stand"  class="accent"  disabled>Stand</button>
      <button id="btn-restart" class="danger" disabled>Restart</button>
    </div>

    <div class="status" id="status">Welcome! Set a bet and press Deal.</div>
  </main>

<!-- ‚úÖ Correct Strubles script path -->
<script src="/strubles.js"></script>

<script>
(() => {
  const suits = ['‚ô†','‚ô•','‚ô¶','‚ô£'];
  const values = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];

  let deck = [];
  let player = [];
  let dealer = [];
  let inRound = false;
  let holeRevealed = false;
  let currentBet = 0;

  const $ = id => document.getElementById(id);
  const dealerEl = $('dealer-hand');
  const playerEl = $('player-hand');
  const statusEl = $('status');
  const totalsEl = $('totals');
  const balEl = $('bal');

  const betInput = $('bet');
  const betMinus = $('bet-minus');
  const betPlus = $('bet-plus');

  const btnDeal = $('btn-deal');
  const btnHit = $('btn-hit');
  const btnStand = $('btn-stand');
  const btnRestart = $('btn-restart');

  function syncBalance(){ balEl.textContent = Strubles.get(); }
  syncBalance();
  window.addEventListener('storage', syncBalance);

  function makeDeck() {
    const d = [];
    for (const s of suits) for (const v of values) d.push({s,v});
    for (let i=d.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [d[i],d[j]] = [d[j],d[i]];
    }
    return d;
  }
  function cardValue(c) {
    if (c.v === 'A') return 11;
    if (['K','Q','J'].includes(c.v)) return 10;
    return parseInt(c.v,10);
  }
  function handValue(hand) {
    let total = 0, aces = 0;
    for (const c of hand){ total += cardValue(c); if (c.v==='A') aces++; }
    while (total > 21 && aces > 0){ total -= 10; aces--; }
    return total;
  }
  function drawCard(faceDown=false){ if (deck.length===0) deck = makeDeck(); const c=deck.pop(); c.faceDown=!!faceDown; return c; }

  function renderHand(hand, el, hideHole=false){
    el.innerHTML = '';
    hand.forEach((c, i) => {
      const div = document.createElement('div');
      div.className = 'card' + ((c.s==='‚ô•'||c.s==='‚ô¶') ? ' red':'');

      if (hideHole && i===1 && !holeRevealed) div.textContent = 'üÇ†';
      else div.textContent = `${c.v}${c.s}`;

      el.appendChild(div);
    });
  }
  function updateTotals(){
    const pv = handValue(player);
    totalsEl.textContent = `Total: ${pv}`;
  }

  function endRound(message){
    inRound = false;
    btnHit.disabled = true;
    btnStand.disabled = true;
    btnRestart.disabled = false;
    btnDeal.disabled = false;
    statusEl.textContent = message;
    currentBet = 0;
    betInput.disabled = false;
    betMinus.disabled = false;
    betPlus.disabled = false;
  }

  function settle(result){
    let payout = 0;
    if (result === 'win') payout = currentBet * 2;
    else if (result === 'blackjack') payout = Math.floor(currentBet * 2.5);
    else if (result === 'push') payout = currentBet;
    if (payout) Strubles.add(payout);
    syncBalance();
  }

  function deal(){
    const bet = Math.max(1, Math.floor(Number(betInput.value || 0)));
    const bal = Strubles.get();
    if (bet > bal) { statusEl.textContent = "Not enough Strubles for that bet."; return; }

    if (!Strubles.spend(bet)) { statusEl.textContent = "Not enough Strubles."; return; }
    syncBalance();
    currentBet = bet;

    deck = makeDeck();
    player = [drawCard(), drawCard()];
    dealer = [drawCard(), drawCard(true)];
    inRound = true;
    holeRevealed = false;

    renderHand(dealer, dealerEl, true);
    renderHand(player, playerEl, false);
    updateTotals();

    betInput.disabled = true;
    betMinus.disabled = true;
    betPlus.disabled = true;

    const pv = handValue(player);
    if (pv ==
